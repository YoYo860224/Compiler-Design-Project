<html>
<body>
<title>Java Assembly Language</title>
<center>
<h1>Java Assembly Language</h1>
</center>
<p>
There is currently no standard syntax for representing Java bytecodes in
human-readable form.  Sun's <b>javap</b> utility provides one 
representation, but its output is complicated by code offsets and constant
pool index numbers.  Thus, a simpler syntax of coding in Java bytecodes was 
created.
<p>
<i>Note: This is documentation on the syntax only.  To understand what the
operands mean and their usage in programming, look at the
<a href="http://java.sun.com/java.sun.com/newdocs.html#JVM">Java Virtual
Machine Specification</a>.  Most of the documentation is beta, meaning some
of it is out-of-date.  Look for the book by Tim Lindholm and Frank Yellin
(to be available sometime this summer by Addison-Wesley) for the latest
documentation.  Excerpts are available at the above link.</i> 
<p>
<a name="classfile"><h2>The Class File Format</h2>
<p>
Each Java Assembly file (usually suffixed by .jasm) should have the following
format:
<p>
<pre>
[abstract] [final] [public] [interface] class <i>classname</i> 
[extends <i>superclassname</i>]
[implements <i>interfacename</i> [<i>interfacename</i> [...] ] ]
{
  [<i><a href="#field_declarations">field_declarations</a></i>]
  [<i><a href="#method_declarations">method_declarations</a></i>]
  [sourcefile <i>sourcefilename</i>]
}
</pre>
<ul>
<li><i>classname</i> is a valid <a href="#classname">class name</a> for this
class
<li><i>superclassname</i> is a valid <a href="#classname">class name</a>
representing the class that this class inherits from.  If <i>superclassname</i>
is missing, the default <b>java.lang.Object</b> superclass is used. 
<li><i>interfacename</i> is a valid <a href="#classname">class name</a>
representing an interface that this class implements. 
<li><i>sourcefilename</i> is a quoted string literal of the name of the source
file (if this assembly program is generated by a compiler).
</ul>
 
<p>
<a name="field_declarations"><h2>Field Declarations</h2>
<p>
The declaration of the class's fields should have the following format:
<pre>
field [<i><a href="#access_specifier">access_specifier</a></i>] [static] [final] [transient] [volatile] <i>fieldname</i> [= <i>constantvalue</i>]
</pre>
<ul>
<li><i>fieldname</i> is an identifier representing the name of the field.
<li><i>constantvalue</i> is a <a href="#constant">constant</a> (appropriate 
to the type of the field) representing the constant value of this field.
</ul>

<p>
<a name="method_declarations"><h2>Method Declarations</h2>
<p>
The declaration of the class's methods should have the following format:
<pre>
method [<i><a href="#access_specifier">access_specifier</a></i>] [static] [abstract] [final] [native] [synchronized] <i>returntype</i> <i>methodname</i> ( [<i>arg1</i> [, <i>arg2</i> [, ...] ] ] )
[throws <i>exceptionname</i> [<i>exceptionname</i> [...] ] ]
max_stack <i>value1</i>
[max_locals <i>value2</i>]
{
  [<i><a href="#code">code</a></i>]
  [<i><a href="#exceptiontable">exceptiontable</a></i>]
  [<i><a href="#linenumbertable">linenumbertable</a></i>]
  [<i><a href="#localvariabletable">localvariabletable</a></i>]
}
</pre>
<ul>
<li><i>returntype</i> is either <b>void</b> or a valid <a href="#type">type</a>.
<li><i>methodname</i> is an identifier representing the method's name.
<li><i>arg1</i>, <i>arg2</i>, ... are valid <a href="#type">types</a> followed
by an optional identifier representing the name of that local variable. 
<li><i>exceptionname</i> is a valid <a href="#classname">class name</a> 
identifying an exception that this method throws.
<li><i>value1</i> is an integer <a href="#constant">constant</a> representing
the maximum size of the stack in this method.
<li><i>value2</i> is an integer <a href="#constant">constant</a> representing
the maximum number of local variable slots needed for this method.  If 
max_locals is not given, the assembler calculates max_locals based on local
variable declarations.
</ul>

<p>
<a name="access_specifier"><h2>Access Specifier</h2>
<p>
An access specifer (used in <a href="#field_declarations">field declarations</a>
and <a href="#method_declarations">method declarations</a>) is one of the
following:
<dl>
<dd> 
<pre>
private
private protected
protected
public 
</pre>
</dl>

<p>
<a name="code"><h2>Code</h2>
<p>
Code is one or more lines in one of the following formats:
<pre>
[<i>label</i>] <i><a href="#operation">operation</a></i>
</pre>
or
<pre>
[<i>label</i>] <i>vartype</i> <i>localvarname</i>
</pre>
<ul>
<li><i>label</i> is an identifier appended with a colon (':') and is used to
mark that position in the code.
<li><i>vartype</i> is a valid <a href="#type">type</a> denoting the type of the
local variable.
<li><i>localvarname</i> is an identifier representing the name of a local 
variable.
</ul>

<p>
<a name="operation"><h2>Operation</h2>
<p>
An operation is in one of the following formats:
<pre>
<i><a href="#noargoperand">no_arg_operand</a></i>

<i><a href="#constantargoperand">constant_arg_operand</a></i> <i>constantval</i>

<i><a href="#fieldrefoperand">field_ref_operand</a></i> <i>fieldtype</i> <i>fieldname</i>

<i><a href="#methodrefoperand">method_ref_operand</a></i> <i>returntype</i> <i>methodname</i> ( [<i>arg1</i> [,<i>arg2</i> [...]]] )

<i><a href="#classrefoperand">class_ref_operand</a></i> <i>classname</i>

<i><a href="#labeloperand">label_operand</a></i> <i>labelname</i>

<i><a href="#localvaroperand">local_var_operand</a></i> <i>localvararg</i>

anewarray <i>anewarrayname</i>

iinc <i>localvararg</i> <i>incrementvalue</i>

lookupswitch 
default <i>defaultlabel</i>
{
  <i>value1</i> : <i>gotolabel1</i> 
  <i>value2</i> : <i>gotolabel2</i>
  ...
}

multianewarray <i>multianewarraytype</i> <i>dimensions</i>

newarray <i>newarraytype</i>

tableswitch <i>beginval</i> to <i>endval</i>
default <i>defaultlabel</i>
{
  <i>gotolabel1</i>
  <i>gotolabel2</i>
  ...
} 
</pre>
<ul>
<li><i>constantval</i> is a valid <a href="#constant">constant</a>.
<li><i>fieldtype</i> is a valid <a href="#type">type</a>.
<li><i>fieldname</i> is a valid <a href="#fieldname">field name</a>.
<li><i>returntype</i> is either <b>void</b> or a valid <a href="#type">type</a>.
<li><i>methodname</i> is a valid <a href="#methodname">method name</a>.
<li><i>arg1</i>, <i>arg2</i>, ... are valid <a href="#type">types</a>.
<li><i>classname</i> is a valid <a href="#classname">class name</a>.
<li><i>labelname</i>, <i>defaultlabel</i>, <i>gotolabel1</i>, <i>gotolabel2</i>
are identifiers corresponding to a label names.
<li><i>localvararg</i> is either an integer representing a slot number or an
identifier representing an already defined local variable.
<li><i>incrementvalue</i>, <i>value1</i>, <i>value2</i>, <i>dimensions</i>, 
<i>beginval</i>, <i>endval</i> are integer constants.
<li><i>anewarraytype</i>, <i>multianewarraytype</i> are either valid 
<a href="#classname">class names</a> or array declarations which are valid 
<a href="#type">types</a> followed by one or more bracket pairs ("[]").
<li><i>newarraytype</i> is one of the following: <b>boolean</b>, <b>char</b>,
<b>float</b>, <b>double</b>, <b>byte</b>, <b>short</b>, <b>int</b>, <b>long</b>.
</ul>

<p>
<a name="exceptiontable"><h2>Exception Table</h2>
<p>
An exception table has the following format:
<pre>
exceptions 
{
  <i>startpc1</i> <i>endpc1</i> <i>handlerpc1</i> <i>catchtype1</i>
  <i>startpc2</i> <i>endpc2</i> <i>handlerpc2</i> <i>catchtype2</i>
  ...
}
</pre>
<ul>
<li><i>startpc1</i>, <i>startpc2</i>, <i>endpc1</i>, <i>endpc2</i>, 
<i>handlerpc1</i>, <i>handlerpc2</i> are identifiers corresponding to label
names.
<li><i>catchtype1</i>, <i>catchtype2</i> are either valid <a href="#classname">
class names</a> or the integer 0.
</ul>

<p>
<a name="linenumbertable"><h2>Line Number Table</h2>
<p>
A line number table has the following format:
<pre>
linenumbertable 
{
  <i>startpc1</i> <i>linenumber1</i>
  <i>startpc2</i> <i>linenumber2</i>
  ...
}
</pre>
<ul>
<li><i>startpc1</i>, <i>startpc2</i> are identifiers corresponding to label
names.
<li><i>linenumber1</i>, <i>linenumber2</i> are valid integers corresponding
to the line numbers in the source file.
</ul>

<p>
<a name="localvariabletable"><h2>Local Variable Table</h2>
<p>
An local variable table has the following format:
<pre>
localvariabletable 
{
  <i>startpc1</i> <i>endpc1</i> <i>type1</i> <i>localvar1</i> <i>slotnum1</i>
  <i>startpc2</i> <i>endpc2</i> <i>type2</i> <i>localvar2</i> <i>slotnum2</i>
  ...
}
</pre>
<ul>
<li><i>startpc1</i>, <i>startpc2</i>, <i>endpc1</i>, <i>endpc2</i>, 
are identifiers corresponding to label names which represent the range
during which the local variables will have a value.
<li><i>type1</i>, <i>type2</i> are valid <a href="#type">types</a> denoting
the types of the given local variables.
<li><i>localvar1</i>, <i>localvar2</i> are identifiers representing the names
of the given local variables.
<li><i>slotnum1</i>, <i>slotnum2</i> are integer constants representing the
slots of the local variables in the method's frame.
</ul>

<p>
<a name="classname"><h2>Class Name</h2>
<p>
A class name has the following format:
<pre>
<i>part1</i>[.<i>part2</i>[.<i>part3</i>[...]]]
</pre>
<ul>
<li><i>part1</i>, <i>part2</i>, ... are identifiers comprising the different
parts of the class name
</ul>

<p>
<a name="fieldname"><h2>Field Name</h2>
<p>
A field name has the following format:
<pre>
[<i>aclass</i>].<i>afield</i>
</pre>
<ul>
<li><i>aclass</i> is a valid <a href="#classname">class name</a>.  If 
<i>aclass</i> is missing, the current class is used.
<li><i>afield</i> is an identifier representing the field name.
</ul>

<p>
<a name="methodname"><h2>Method Name</h2>
<p>
A method name has the following format:
<pre>
[<i>aclass</i>].<i>amethod</i>
</pre>
<ul>
<li><i>aclass</i> is a valid <a href="#classname">class name</a>.  If 
<i>aclass</i> is missing, the current class is used.
<li><i>amethod</i> is an identifier representing the method name.
</ul>

<p>
<a name="constant"><h2>Constant</h2>
<p>
Constants are defined much like in Java:
<ul>
<li>floating-point numbers are assumed to be double, unless suffixed by the
letter <b>F</b>, in which case they are considered to be of type float.
<li>integers are assumed to be of type int unless suffixed by the letter
<b>L</b>, in which case they are considered to be of type long.
<li>strings should be enclosed in double-quotes.
<li>characters should be enclosed in single-quotes.
<li><b>0x</b> indicates that the following number is in hexadecimal format.
</ul>

<p>
<a name="type"><h2>Type</h2>
<p>
A type has the following format:
<pre>
<i>basetype</i>[<i>bracketpair</i>[<i>bracketpair</i>[...]]]
</pre>
<ul>
<li><i>basetype</i> is either a <a href="#classname">class name</a> or one of
the following: <b>byte</b>, <b>char</b>, <b>double</b>, <b>float</b>,
<b>int</b>, <b>long</b>, <b>short</b>, <b>boolean</b>.
<li><i>bracketpair</i> is a matching pair of brackets ("[]") and denotes
array dimensions.
</ul>

<p>
<a name="noargoperand"><h2>No Arg Operand</h2>
The following are no arg operands:
<p>
<b>
aaload aastore aconst_null aload_0 aload_1 aload_2 aload_3 areturn 
arraylength astore_0 astore_1 astore_2 astore_3 athrow baload bastore caload
castore d2f d2i d2l dadd daload dastore dcmpg dcmpl dconst_0 dconst_1
ddiv dload_0 dload_1 dload_2 dload_3 dmul dneg drem dreturn dstore_0 
dstore_1 dstore_2 dstore_3 dsub dup dup_x1 dup_x2 dup2 dup2_x1 dup2_x2
f2d f2i f2l fadd faload fastore fcmpg fcmpl fconst_0 fconst_1 fdiv fload_0
fload_1 fload_2 fload_3 fmul fneg frem freturn fstore_0 fstore_1 fstore_2
fstore_3 fsub i2b i2c i2d i2f i2l i2s iadd iaload iand iastore iconst_0
iconst_1 iconst_2 iconst_3 iconst_4 iconst_5 iconst_m1 idiv iload_0 iload_1
iload_2 iload_3 imul ineg ior irem ireturn ishl ishr istore_0 istore_1
istore_2 istore_3 isub iushr ixor l2d l2f l2i ladd laload land lastore lcmp
lconst_0 lconst_1 ldiv lload_0 lload_1 lload_2 lload_3 lmul lneg lor lrem 
lreturn lshl lshr lstore_0 lstore_1 lstore_2 lstore_3 lsub lushr lxor
monitorenter monitorexit nop pop pop2 return saload sastore swap wide 
</b>
<p>

<p>
<a name="constantargoperand"><h2>Constant Arg Operand</h2>
The following are constant arg operands:
<p>
<b>
bipush ldc ldc_w ldc2_w sipush
</b>
<p>

<p>
<a name="fieldrefoperand"><h2>Field Ref Operand</h2>
The following are field ref operands:
<p>
<b>
getfield getstatic putfield putstatic
</b>
<p>

<p>
<a name="methodrefoperand"><h2>Method Ref Operand</h2>
The following are method ref operands:
<p>
<b>
invokeinterface invokestatic invokenonvirtual invokevirtual
</b>
<p>

<p>
<a name="classrefoperand"><h2>Class Ref Operand</h2>
The following are class ref operands:
<p>
<b>
checkcast instanceof new
</b>
<p>

<p>
<a name="labeloperand"><h2>Label Operand</h2>
The following are label operands:
<p>
<b>
goto goto_w if_acmpeq if_acmpne if_icmpeq if_icmpne if_icmplt if_icmpge
if_icmpgt if_icmple ifeq ifne iflt ifge ifgt ifle ifnonnull ifnull jsr jsr_w
</b>
<p>

<p>
<a name="localvaroperand"><h2>Local Var Operand</h2>
The following are local var operands:
<p>
<b>
iload fload aload lload dload istore fstore astore lstore dstore ret
load store
</b>
<p>
<ul>
<li><b>load</b> and <b>store</b> are not standard Java bytecode operands.
When followed by a local variable name, <b>load</b> and <b>store</b> are
changed to the proper <i>x</i><b>load</b> or <i>x</i><b>store</b> command
based on the type of the local variable.
</ul>
<p>

<p>
<h2>General Notes</h2>
<ul>
<li>Keywords are NOT case-sensitive.  However, labels and local variable names
are case-sensitive.
<li>C-like comments (using /* and */) are accepted.
<li>Keywords cannot be used as identifiers.
<li>Only ascii (not unicode) is supported.
</ul>
